{% load i18n static %}
<!DOCTYPE html>
<html>
<head>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>{% block title %}OEP{% endblock %}</title>

    <link rel="icon" type="image/png" href="{% static 'logo.png' %}" />

    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&family=Pacifico&display=swap" rel="stylesheet">

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

    <!--link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css" /-->
    <link rel="stylesheet" href="https://bootswatch.com/4/yeti/bootstrap.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>

    {% block head %}
    {% endblock %}

</head>


<body>

{% block navbar %}

	<nav class="navbar navbar-expand-lg navbar-light bg-light">
		<div class="container">

			<a class="navbar-brand" href="{% if workshop %}{% url 'mapper_index_workshop' workshop_slug=workshop.slug %}{% else %}{% url 'mapper_index' %}{% endif %}">
				{% trans "OEP Stakeholder Mapper" %}
				{% if workshop %}
				- {{ workshop.name }}
				{% endif %}
			</a>

			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTopSupportedContent">
				<span class="navbar-toggler-icon"></span>
			</button>

			<div class="collapse navbar-collapse" id="navbarTopSupportedContent">

				<ul class="navbar-nav mr-auto">
				</ul>

				<form class="form-inline my-2 my-lg-0">
					<input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
					<button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
				</form>

			</div>

		</div>
	</nav>

	<nav class="navbar navbar-expand-lg fixed-bottom navbar-light bg-light">
		<div class="container">

			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent">
				<span class="navbar-toggler-icon"></span>
			</button>

			<div class="collapse navbar-collapse" id="navbarSupportedContent">

				<ul class="navbar-nav">
					<li class="nav-item dropup">
						<a class="nav-link dropdown-toggle" href="#" id="newDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
						  {% trans "Manage" %}
						</a>
						<div class="dropdown-menu" aria-labelledby="newDropdown">
							<a class="dropdown-item" href="#" data-toggle="modal" data-target="#modalAddEntity">
								{% trans "Add stakeholder" %}
							</a>
							<a class="dropdown-item" href="#" data-toggle="modal" data-target="#">
								{% trans "Extend your map" %}
							</a>
							<div class="dropdown-divider"></div>
							<a class="dropdown-item" href="{% if workshop %}{% url 'page_detail_workshop' workshop_slug=workshop.slug page_no=1 %}{% else %}{% url 'page_detail' page_no=1 %}{% endif %}">
								{% trans "Start over" %}
							</a>
						</div>
					</li>
					<li class="nav-item dropup">
						<a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
						  {% trans "View" %}
						</a>
						<div class="dropdown-menu" aria-labelledby="newDropdown">
							<a class="dropdown-item" href="{% url 'mapper_ring' %}">
								{% trans "Interaction circles" %}
							</a>
							<a class="dropdown-item" href="{% url 'mapper_venn' %}">
								{% trans "Venn diagram" %}
							</a>
							<a class="dropdown-item" href="{% url 'mapper_suggest' %}">
								{% trans "Collaborator suggestions" %}
							</a>
						</div>
					</li>
					<li class="nav-item dropup">
						<a class="nav-link dropdown-toggle" href="#" id="exportDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							{% trans "Export" %}
						</a>
						<div class="dropdown-menu" aria-labelledby="exportDropdown">
							<a class="dropdown-item" href="#" id="exportJSON" download="network.json">
								{% trans "Data (JSON)" %}
							</a>
							<a class="dropdown-item" href="#" id="exportPNG" download="network.png">
								{% trans "Image (PNG)" %}
							</a>
							<div class="dropdown-divider"></div>
							<a class="dropdown-item" href="#" id="btnSave">
								{% trans "Save" %}
							</a>
						</div>
					</li>
				</ul>

				<ul class="navbar-nav ml-auto" id="ulGroups">
					{% if next_page %}
						<a href="{% if workshop %}{% url 'page_detail_workshop' workshop_slug=workshop.slug page_no=next_page %}{% else %}{% url 'page_detail' page_no=next_page %}{% endif %}" class="btn btn-primary" id="btnNext">
							Continue
						</a>
					{% else %}

					{% endif %}
				</ul>

			</div>

		</div>
	</nav>

{% endblock %}

<br>

{% block content %}
{% endblock %}

<br>
<br>
<br>
<br>

{% block js %}
{% endblock %}


<div class="modal" tabindex="-1" role="dialog" id="modalSave">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Agree with the privacy terms</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>
			To download map image and data to continue working on it later, agree with the data usage terms.
			No identifiable data will be shared or published. Read more about how we protect your data.
		</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">I don't agree</button>
        <button type="button" class="btn btn-primary" id="btnTermsOK">I agree</button>
      </div>
    </div>
  </div>
</div>


<script>

$(document).ready(function() {

	var termsOK = '{{ terms_ok }}';

	function mapSave() {
		$.post('{% url "mapper_save" %}', function(data) {
			console.log(data);
		});
	};

	$('#btnSave').click(function() {
		console.log(termsOK);
		if (termsOK) {
			mapSave();
		} else {
			$('#modalSave').modal('show');
		}
	});

	$('#btnTermsOK').click(function() {
		$.post('{% url "mapper_approve_terms" %}', function(data) {
			termsOK = true;
			$('#modalSave').modal('hide');
		});
	});

});

</script>

</body>
</html>
