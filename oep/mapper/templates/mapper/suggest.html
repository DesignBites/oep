{% extends 'mapper/base.html' %}
{% load i18n static crispy_forms_tags %}


{% block head %}

    <script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/sigma.min.js" integrity="sha512-4+XX9O3GEcpTWGNW7m3w/ORF91L4zUX01/U3wAoWIXp1P+LRBEqutZdQIFUeHSa0cJRZ9LPM+GOWus8h8TlYhg==" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/plugins/sigma.plugins.animate.min.js" integrity="sha512-WxjvX/yh2SfCPUnVmZkn4MYkF/jw8GKtEjFu2+P28bcqdYYsT6feJuaaQyBw7+KWfs87Ol4jb7jB+8qep+cocg==" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/plugins/sigma.plugins.dragNodes.min.js" integrity="sha512-w9i2zoWU7Te0i+TJoKMyBjHYAptYykPieNa0iT6/ofVbUHvqIhh6f4YVkXV84kAuGbIS+CqvSV/6AHTVt8bUrA==" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/plugins/sigma.layout.noverlap.min.js" integrity="sha512-U0UOV2CPSrFlOxjSnHr6GMKsRjQIYmarSCgVp9R6FAcby2gLNPgQtGLXylELTBDLbS/R5g1vj5CFS4mLDdDfxQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/plugins/sigma.parsers.json.min.js" integrity="sha512-uhhcXJvqfQpnVqJRyCs49Ddt16zZ35qFokRiVOZei14sbMdMS9vtubrb1QQvGJ/zQhQbCttBvVJqqiZHrsHo1g==" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/plugins/sigma.layout.forceAtlas2.min.js" integrity="sha512-RuRd3WCUb6GCaiaEJ2UDkaVblIVAHJNLaDG6Df2OWpzg4kQurQqh/GC/a3eFSopnRiNrwePMFvI13pbYZ1WnAw==" crossorigin="anonymous"></script>
	<!--script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/plugins/sigma.renderers.edgeLabels.min.js" integrity="sha512-NdmXr+AEuaizDckUjMI05kDsdoXbj6Z0fDxqAqPfhecHITSzGWPA/zeE/ousxA4pVIALj0V6/JgfTGYT9aS7Jw==" crossorigin="anonymous"></script-->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/plugins/sigma.renderers.snapshot.min.js" integrity="sha512-hRIEjoSHrn4AeSezC5FE4/5QjnuiV3CtsjBdrG8sE7Rvs+PZ6PpTggvcBcw8VSH5KyoBhTAbPeMsa9tokxQ0yw==" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/plugins/sigma.renderers.customShapes.min.js" integrity="sha512-mTo2l94Z6Gvx7WZPYhiQI/TpFaRwJL3cEWo8Uqmx0J1336W2b7oB6t11B1YDgqMuOwCcYdRrHrEdGSts3zCz7g==" crossorigin="anonymous"></script>

{% endblock %}


{% block content %}

<div class="container">

	<div class="row">

		{% if title %}
			<h2>{{ title|safe }}</h2>
		{% endif %}

		{% if description %}
			<p class="lead">{{ description|safe }}</p>
		{% endif %}

		<div class="col-6">

			<h3>
				{{ title_1 }}
			</h3>
			<p>
				{{ description_1 }}
			</p>

			<div id="canvas1" style="height: 300px;"></div>

		</div>

		<div class="col-6">

			<h3>
				{{ title_2 }}
			</h3>
			<p>
				{{ description_2 }}
			</p>

			<div id="canvas2" style="height: 300px;"></div>

		</div>

	</div>

</div>

{% endblock %}


{% block js %}

<script>

	var sigmaSettings = {
		settings: {
			minNodeSize: 1,
			maxNodeSize: 10,
			minEdgeSize: 1,
			maxEdgeSize: 3,
			//edgeLabelSize: 'proportional',
			labelThreshold: 1,
			autoRescale: false,
			zoomMin: 1,
			zoomMax: 1
		}
    }

    var g1 = { nodes: {% if graph.nodes.1 %}{{ graph.nodes.1|safe }}{% else %}[]{% endif %} };
    var g2 = { nodes: {% if graph.nodes.2 %}{{ graph.nodes.2|safe }}{% else %}[]{% endif %} };

    var s1 = new sigma({
    	graph: g1,
		renderer: {
    		container: 'canvas1',
    		type: 'canvas'
    	},
		settings: sigmaSettings
	});
	CustomShapes.init(s1);
	s1.refresh();

    var s2 = new sigma({
    	graph: g2,
		renderer: {
    		container: 'canvas2',
    		type: 'canvas'
    	},
		settings: sigmaSettings
	});
	CustomShapes.init(s2);
	s2.refresh();


	var $exportPNG = $('#exportPNG');
    $exportPNG.click(function() {
        var src_base64 = s.renderers[0].snapshot({format: 'png', background: 'white', labels: true});
        $exportPNG.attr('href', src_base64);
    });

	var $exportJSON = $('#exportJSON');
    $exportJSON.click(function() {
		var data = btoa(
			JSON.stringify({
				name: s.graph.nodes()[0].label,
				graph: {
					nodes: s.graph.nodes(),
					edges: s.graph.edges()
				}
			})
		);
        $exportJSON.attr('href', 'data:text/json;base64,' + data);
    });

</script>

{% endblock %}